<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation API - SMS Gateway</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        .doc-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .doc-sidebar {
            position: fixed;
            left: 0;
            top: 80px;
            width: 250px;
            height: calc(100vh - 80px);
            background: var(--surface-color);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 20px;
            z-index: 100;
        }
        
        .doc-content {
            margin-left: 270px;
            padding: 20px;
        }
        
        .doc-section {
            margin-bottom: 40px;
            padding: 20px;
            background: var(--surface-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .doc-section h2 {
            color: var(--accent-blue);
            border-bottom: 2px solid var(--accent-blue);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .doc-section h3 {
            color: var(--accent-green);
            margin-top: 30px;
            margin-bottom: 15px;
        }
        
        .api-endpoint {
            background: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 12px;
            margin-right: 10px;
        }
        
        .method.get { background: #28a745; color: white; }
        .method.post { background: #007bff; color: white; }
        .method.put { background: #ffc107; color: black; }
        .method.delete { background: #dc3545; color: white; }
        
        .endpoint-url {
            font-family: 'Courier New', monospace;
            background: var(--surface-color);
            padding: 8px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            margin: 10px 0;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .response-example {
            background: #1a202c;
            color: #68d391;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        
        .nav-link {
            display: block;
            padding: 8px 12px;
            color: var(--text-color);
            text-decoration: none;
            border-radius: 4px;
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            background: var(--accent-blue);
            color: white;
        }
        
        .nav-link.active {
            background: var(--accent-green);
            color: white;
        }
        
        .parameter-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .parameter-table th,
        .parameter-table td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: left;
        }
        
        .parameter-table th {
            background: var(--surface-color);
            font-weight: bold;
        }
        
        .required {
            color: var(--accent-red);
            font-weight: bold;
        }
        
        .optional {
            color: var(--text-secondary);
        }
        
        .status-code {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 12px;
        }
        
        .status-200 { background: #d4edda; color: #155724; }
        .status-400 { background: #f8d7da; color: #721c24; }
        .status-500 { background: #f5c6cb; color: #721c24; }
        
        .integration-example {
            background: var(--background-color);
            border-left: 4px solid var(--accent-blue);
            padding: 20px;
            margin: 20px 0;
        }
        
        .copy-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .code-container {
            position: relative;
        }
        
        @media (max-width: 768px) {
            .doc-sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .doc-sidebar.open {
                transform: translateX(0);
            }
            
            .doc-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body class="cyberpunk-theme">
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-mobile-alt"></i>
                SMS Gateway - Documentation
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-home"></i> Accueil
                    </a>
                </li>
                <li class="nav-item">
                    <a href="messages.html" class="nav-link">
                        <i class="fas fa-envelope"></i> Messages
                    </a>
                </li>
                <li class="nav-item">
                    <a href="phones.html" class="nav-link">
                        <i class="fas fa-mobile-alt"></i> T√©l√©phones
                    </a>
                </li>
                <li class="nav-item">
                    <a href="sims.html" class="nav-link">
                        <i class="fas fa-sim-card"></i> SIMs
                    </a>
                </li>
                <li class="nav-item">
                    <a href="autoswitch.html" class="nav-link">
                        <i class="fas fa-exchange-alt"></i> Auto-Switch
                    </a>
                </li>
                <li class="nav-item">
                    <a href="documentation.html" class="nav-link active">
                        <i class="fas fa-book"></i> Documentation
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="doc-container">
        <!-- Sidebar Navigation -->
        <div class="doc-sidebar">
            <h3><i class="fas fa-list"></i> Table des mati√®res</h3>
            <a href="#introduction" class="nav-link">Introduction</a>
            <a href="#authentication" class="nav-link">Authentification</a>
            <a href="#messages-api" class="nav-link">API Messages</a>
            <a href="#phones-api" class="nav-link">API T√©l√©phones</a>
            <a href="#sims-api" class="nav-link">API SIMs</a>
            <a href="#autoswitch-api" class="nav-link">API Auto-Switch</a>
            <a href="#system-api" class="nav-link">API Syst√®me</a>
            <a href="#webhooks" class="nav-link">Webhooks</a>
            <a href="#examples" class="nav-link">Exemples d'int√©gration</a>
            <a href="#sdks" class="nav-link">SDKs</a>
            <a href="#errors" class="nav-link">Gestion d'erreurs</a>
        </div>

        <!-- Main Content -->
        <div class="doc-content">
            <!-- Introduction -->
            <div id="introduction" class="doc-section">
                <h2><i class="fas fa-rocket"></i> Introduction</h2>
                <p>Bienvenue dans la documentation de l'API SMS Gateway. Cette API vous permet d'envoyer des SMS, de g√©rer plusieurs cartes SIM, et d'automatiser le basculement entre op√©rateurs.</p>
                
                <h3>URL de base</h3>
                <div class="endpoint-url">
                    <strong>Production:</strong> https://votre-domaine.com/api<br>
                    <strong>D√©veloppement:</strong> http://168.231.85.4:3001/api
                </div>

                <h3>Fonctionnalit√©s principales</h3>
                <ul>
                    <li>‚úÖ Envoi de SMS via multiple cartes SIM</li>
                    <li>‚úÖ Gestion automatique des quotas</li>
                    <li>‚úÖ Basculement automatique entre op√©rateurs</li>
                    <li>‚úÖ Historique complet des messages</li>
                    <li>‚úÖ Monitoring en temps r√©el</li>
                    <li>‚úÖ API RESTful compl√®te</li>
                </ul>

                <h3>Formats support√©s</h3>
                <p>L'API accepte et retourne du JSON. Assurez-vous d'inclure le header <code>Content-Type: application/json</code> dans vos requ√™tes.</p>
            </div>

            <!-- Authentication -->
            <div id="authentication" class="doc-section">
                <h2><i class="fas fa-shield-alt"></i> Authentification</h2>
                <p>Actuellement, l'API ne n√©cessite pas d'authentification pour les environnements de d√©veloppement. En production, nous recommandons d'impl√©menter une authentification par cl√© API.</p>
                
                <div class="integration-example">
                    <h4>Exemple d'authentification future (recommand√©)</h4>
                    <div class="code-container">
                        <div class="code-block">
curl -X POST "https://api.smsgateway.com/api/messages/send" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"recipient": "+33612345678", "message": "Hello World"}'
                        </div>
                    </div>
                </div>
            </div>

            <!-- Messages API -->
            <div id="messages-api" class="doc-section">
                <h2><i class="fas fa-envelope"></i> API Messages</h2>
                
                <div class="api-endpoint">
                    <span class="method post">POST</span>
                    <strong>/api/messages/send</strong>
                    <p>Envoie un SMS via la SIM par d√©faut ou une SIM sp√©cifique.</p>
                    
                    <h4>Param√®tres</h4>
                    <table class="parameter-table">
                        <tr>
                            <th>Param√®tre</th>
                            <th>Type</th>
                            <th>Requis</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td>recipient</td>
                            <td>string</td>
                            <td class="required">Oui</td>
                            <td>Num√©ro de t√©l√©phone au format international (+33612345678)</td>
                        </tr>
                        <tr>
                            <td>message</td>
                            <td>string</td>
                            <td class="required">Oui</td>
                            <td>Contenu du message (max 160 caract√®res par SMS)</td>
                        </tr>
                        <tr>
                            <td>sim_id</td>
                            <td>integer</td>
                            <td class="optional">Non</td>
                            <td>ID de la SIM √† utiliser (utilise la SIM par d√©faut si omis)</td>
                        </tr>
                        <tr>
                            <td>priority</td>
                            <td>string</td>
                            <td class="optional">Non</td>
                            <td>Priorit√© du message: "low", "normal", "high" (d√©faut: "normal")</td>
                        </tr>
                    </table>

                    <h4>Exemple de requ√™te</h4>
                    <div class="code-container">
                        <div class="code-block">
{
  "recipient": "+33612345678",
  "message": "Bonjour ! Votre commande #12345 a √©t√© exp√©di√©e.",
  "priority": "high"
}
                        </div>
                    </div>

                    <h4>R√©ponse</h4>
                    <div class="response-example">
{
  "success": true,
  "message": "SMS envoy√© avec succ√®s",
  "data": {
    "id": 1234,
    "recipient": "+33612345678",
    "message": "Bonjour ! Votre commande #12345 a √©t√© exp√©di√©e.",
    "sim_used": {
      "id": 32,
      "carrier_name": "LycaMobile",
      "phone_number": "+33745520050"
    },
    "status": "sent",
    "created_at": "2025-05-26T22:30:00.000Z"
  }
}
                    </div>
                </div>

                <div class="api-endpoint">
                    <span class="method get">GET</span>
                    <strong>/api/messages/history</strong>
                    <p>R√©cup√®re l'historique des messages envoy√©s.</p>
                    
                    <h4>Param√®tres de requ√™te</h4>
                    <table class="parameter-table">
                        <tr>
                            <th>Param√®tre</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td>page</td>
                            <td>integer</td>
                            <td>Num√©ro de page (d√©faut: 1)</td>
                        </tr>
                        <tr>
                            <td>limit</td>
                            <td>integer</td>
                            <td>Nombre d'√©l√©ments par page (d√©faut: 50, max: 100)</td>
                        </tr>
                        <tr>
                            <td>status</td>
                            <td>string</td>
                            <td>Filtrer par statut: "pending", "sent", "failed"</td>
                        </tr>
                        <tr>
                            <td>sim_id</td>
                            <td>integer</td>
                            <td>Filtrer par SIM utilis√©e</td>
                        </tr>
                        <tr>
                            <td>date_from</td>
                            <td>string</td>
                            <td>Date de d√©but (format: YYYY-MM-DD)</td>
                        </tr>
                        <tr>
                            <td>date_to</td>
                            <td>string</td>
                            <td>Date de fin (format: YYYY-MM-DD)</td>
                        </tr>
                    </table>

                    <h4>Exemple de requ√™te</h4>
                    <div class="code-block">
GET /api/messages/history?page=1&limit=20&status=sent&date_from=2025-05-01
                    </div>
                </div>

                <div class="api-endpoint">
                    <span class="method get">GET</span>
                    <strong>/api/messages/pending</strong>
                    <p>R√©cup√®re les messages en attente d'envoi pour un t√©l√©phone sp√©cifique.</p>
                    
                    <h4>Param√®tres de requ√™te</h4>
                    <table class="parameter-table">
                        <tr>
                            <th>Param√®tre</th>
                            <th>Type</th>
                            <th>Requis</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td>phone_id</td>
                            <td>string</td>
                            <td class="required">Oui</td>
                            <td>ID unique du t√©l√©phone</td>
                        </tr>
                        <tr>
                            <td>limit</td>
                            <td>integer</td>
                            <td class="optional">Non</td>
                            <td>Nombre maximum de messages √† r√©cup√©rer (d√©faut: 10)</td>
                        </tr>
                    </table>
                </div>

                <div class="api-endpoint">
                    <span class="method put">PUT</span>
                    <strong>/api/messages/status</strong>
                    <p>Met √† jour le statut d'un message.</p>
                    
                    <h4>Param√®tres</h4>
                    <table class="parameter-table">
                        <tr>
                            <th>Param√®tre</th>
                            <th>Type</th>
                            <th>Requis</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td>message_id</td>
                            <td>integer</td>
                            <td class="required">Oui</td>
                            <td>ID du message √† mettre √† jour</td>
                        </tr>
                        <tr>
                            <td>status</td>
                            <td>string</td>
                            <td class="required">Oui</td>
                            <td>Nouveau statut: "sent", "failed", "delivered"</td>
                        </tr>
                        <tr>
                            <td>error_message</td>
                            <td>string</td>
                            <td class="optional">Non</td>
                            <td>Message d'erreur si status = "failed"</td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- Phones API -->
            <div id="phones-api" class="doc-section">
                <h2><i class="fas fa-mobile-alt"></i> API T√©l√©phones</h2>
                
                <div class="api-endpoint">
                    <span class="method get">GET</span>
                    <strong>/api/phones</strong>
                    <p>R√©cup√®re la liste de tous les t√©l√©phones enregistr√©s.</p>
                    
                    <h4>R√©ponse</h4>
                    <div class="response-example">
{
  "success": true,
  "data": [
    {
      "id": "1283e97f-b54b-4793-98bd-76c3bc1f7e00",
      "model": "SM-A326B",
      "android_version": "13",
      "status": "active",
      "last_seen": "2025-05-26T22:30:00.000Z",
      "sim_count": 2,
      "created_at": "2025-05-26T21:38:01.000Z"
    }
  ]
}
                    </div>
                </div>

                <div class="api-endpoint">
                    <span class="method post">POST</span>
                    <strong>/api/phones/register</strong>
                    <p>Enregistre un nouveau t√©l√©phone dans le syst√®me.</p>
                    
                    <h4>Param√®tres</h4>
                    <table class="parameter-table">
                        <tr>
                            <th>Param√®tre</th>
                            <th>Type</th>
                            <th>Requis</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td>phone_id</td>
                            <td>string</td>
                            <td class="required">Oui</td>
                            <td>ID unique du t√©l√©phone (UUID)</td>
                        </tr>
                        <tr>
                            <td>model</td>
                            <td>string</td>
                            <td class="required">Oui</td>
                            <td>Mod√®le du t√©l√©phone</td>
                        </tr>
                        <tr>
                            <td>android_version</td>
                            <td>string</td>
                            <td class="required">Oui</td>
                            <td>Version d'Android</td>
                        </tr>
                        <tr>
                            <td>sims</td>
                            <td>array</td>
                            <td class="required">Oui</td>
                            <td>Liste des SIMs d√©tect√©es</td>
                        </tr>
                    </table>
                </div>

                <div class="api-endpoint">
                    <span class="method put">PUT</span>
                    <strong>/api/phones/{phone_id}/heartbeat</strong>
                    <p>Met √† jour le statut de connexion d'un t√©l√©phone.</p>
                </div>
            </div>

            <!-- SIMs API -->
            <div id="sims-api" class="doc-section">
                <h2><i class="fas fa-sim-card"></i> API SIMs</h2>
                
                <div class="api-endpoint">
                    <span class="method get">GET</span>
                    <strong>/api/sims</strong>
                    <p>R√©cup√®re la liste de toutes les cartes SIM avec leurs quotas.</p>
                    
                    <h4>R√©ponse</h4>
                    <div class="response-example">
{
  "success": true,
  "data": [
    {
      "id": 32,
      "phone_number": "+33745520050",
      "carrier_name": "LycaMobile",
      "is_active": true,
      "is_default": true,
      "monthly_limit": 30000,
      "messages_sent_month": 91,
      "recipients_monthly_limit": 50,
      "recipients_monthly": 10,
      "usage_percentage": 20.0
    }
  ]
}
                    </div>
                </div>

                <div class="api-endpoint">
                    <span class="method put">PUT</span>
                    <strong>/api/sims/{sim_id}/config</strong>
                    <p>Met √† jour la configuration d'une SIM.</p>
                    
                    <h4>Param√®tres</h4>
                    <table class="parameter-table">
                        <tr>
                            <th>Param√®tre</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td>monthly_limit</td>
                            <td>integer</td>
                            <td>Limite mensuelle de SMS</td>
                        </tr>
                        <tr>
                            <td>recipients_monthly_limit</td>
                            <td>integer</td>
                            <td>Limite mensuelle de destinataires uniques</td>
                        </tr>
                        <tr>
                            <td>is_active</td>
                            <td>boolean</td>
                            <td>Activer/d√©sactiver la SIM</td>
                        </tr>
                        <tr>
                            <td>is_default</td>
                            <td>boolean</td>
                            <td>D√©finir comme SIM par d√©faut</td>
                        </tr>
                    </table>
                </div>

                <div class="api-endpoint">
                    <span class="method get">GET</span>
                    <strong>/api/sims/stats</strong>
                    <p>R√©cup√®re les statistiques globales des SIMs.</p>
                </div>
            </div>

            <!-- Auto-Switch API -->
            <div id="autoswitch-api" class="doc-section">
                <h2><i class="fas fa-exchange-alt"></i> API Auto-Switch</h2>
                
                <div class="api-endpoint">
                    <span class="method get">GET</span>
                    <strong>/api/autoswitch/status</strong>
                    <p>R√©cup√®re le statut du syst√®me de basculement automatique.</p>
                    
                    <h4>R√©ponse</h4>
                    <div class="response-example">
{
  "success": true,
  "data": {
    "enabled": true,
    "status": "normal",
    "message": "Syst√®me fonctionnel",
    "default_sim": {
      "carrier_name": "LycaMobile",
      "phone_number": "+33745520050",
      "max_usage_percentage": 20.0
    },
    "available_sims": [],
    "config": {
      "quota_alert_threshold": 80,
      "quota_check_frequency": 180
    }
  }
}
                    </div>
                </div>

                <div class="api-endpoint">
                    <span class="method put">PUT</span>
                    <strong>/api/autoswitch/config</strong>
                    <p>Met √† jour la configuration du syst√®me auto-switch.</p>
                    
                    <h4>Param√®tres</h4>
                    <table class="parameter-table">
                        <tr>
                            <th>Param√®tre</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td>auto_switch_enabled</td>
                            <td>boolean</td>
                            <td>Activer/d√©sactiver le basculement automatique</td>
                        </tr>
                        <tr>
                            <td>quota_alert_threshold</td>
                            <td>integer</td>
                            <td>Seuil d'alerte en pourcentage (1-100)</td>
                        </tr>
                        <tr>
                            <td>quota_check_frequency</td>
                            <td>integer</td>
                            <td>Fr√©quence de v√©rification en secondes (min: 30)</td>
                        </tr>
                        <tr>
                            <td>sms_notifications_enabled</td>
                            <td>boolean</td>
                            <td>Activer les notifications SMS d'alerte</td>
                        </tr>
                        <tr>
                            <td>notification_phone_number</td>
                            <td>string</td>
                            <td>Num√©ro pour recevoir les notifications</td>
                        </tr>
                    </table>
                </div>

                <div class="api-endpoint">
                    <span class="method post">POST</span>
                    <strong>/api/autoswitch/switch</strong>
                    <p>Force un basculement manuel vers la meilleure SIM disponible.</p>
                </div>
            </div>

            <!-- System API -->
            <div id="system-api" class="doc-section">
                <h2><i class="fas fa-cogs"></i> API Syst√®me</h2>
                
                <div class="api-endpoint">
                    <span class="method get">GET</span>
                    <strong>/api/health</strong>
                    <p>V√©rifie l'√©tat de sant√© du syst√®me.</p>
                    
                    <h4>R√©ponse</h4>
                    <div class="response-example">
{
  "success": true,
  "status": "healthy",
  "database": "connected",
  "version": "1.0.0",
  "stats": {
    "phones": 1,
    "active_phones": 1,
    "sims": 2,
    "messages_today": 15
  }
}
                    </div>
                </div>

                <div class="api-endpoint">
                    <span class="method get">GET</span>
                    <strong>/api/system/stats</strong>
                    <p>R√©cup√®re les statistiques d√©taill√©es du syst√®me.</p>
                </div>
            </div>

            <!-- Webhooks -->
            <div id="webhooks" class="doc-section">
                <h2><i class="fas fa-webhook"></i> Webhooks</h2>
                <p>Les webhooks vous permettent de recevoir des notifications en temps r√©el sur les √©v√©nements importants.</p>
                
                <h3>√âv√©nements disponibles</h3>
                <ul>
                    <li><strong>message.sent</strong> - Message envoy√© avec succ√®s</li>
                    <li><strong>message.failed</strong> - √âchec d'envoi de message</li>
                    <li><strong>sim.quota_alert</strong> - Quota SIM atteint</li>
                    <li><strong>autoswitch.switched</strong> - Basculement automatique effectu√©</li>
                    <li><strong>phone.disconnected</strong> - T√©l√©phone d√©connect√©</li>
                </ul>

                <h3>Configuration des webhooks</h3>
                <div class="integration-example">
                    <h4>Exemple de payload webhook</h4>
                    <div class="code-block">
{
  "event": "message.sent",
  "timestamp": "2025-05-26T22:30:00.000Z",
  "data": {
    "message_id": 1234,
    "recipient": "+33612345678",
    "sim_used": {
      "id": 32,
      "carrier_name": "LycaMobile"
    }
  }
}
                    </div>
                </div>
            </div>

            <!-- Examples -->
            <div id="examples" class="doc-section">
                <h2><i class="fas fa-code"></i> Exemples d'int√©gration</h2>
                
                <h3>JavaScript / Node.js</h3>
                <div class="code-container">
                    <div class="code-block">
// Envoi d'un SMS simple
const sendSMS = async (recipient, message) => {
  try {
    const response = await fetch('http://168.231.85.4:3001/api/messages/send', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        recipient: recipient,
        message: message
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      console.log('SMS envoy√©:', result.data.id);
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('Erreur envoi SMS:', error);
    throw error;
  }
};

// Utilisation
sendSMS('+33612345678', 'Votre code de v√©rification: 123456')
  .then(data => console.log('Message envoy√© avec succ√®s'))
  .catch(error => console.error('Erreur:', error));
                    </div>
                </div>

                <h3>PHP</h3>
                <div class="code-container">
                    <div class="code-block">
&lt;?php
class SMSGateway {
    private $baseUrl;
    
    public function __construct($baseUrl = 'http://168.231.85.4:3001/api') {
        $this->baseUrl = $baseUrl;
    }
    
    public function sendSMS($recipient, $message, $simId = null) {
        $data = [
            'recipient' => $recipient,
            'message' => $message
        ];
        
        if ($simId) {
            $data['sim_id'] = $simId;
        }
        
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $this->baseUrl . '/messages/send');
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
        curl_setopt($ch, CURLOPT_HTTPHEADER, [
            'Content-Type: application/json'
        ]);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        
        $response = curl_exec($ch);
        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        curl_close($ch);
        
        if ($httpCode === 200) {
            return json_decode($response, true);
        } else {
            throw new Exception('Erreur HTTP: ' . $httpCode);
        }
    }
    
    public function getHistory($page = 1, $limit = 50) {
        $url = $this->baseUrl . '/messages/history?page=' . $page . '&limit=' . $limit;
        
        $response = file_get_contents($url);
        return json_decode($response, true);
    }
}

// Utilisation
$sms = new SMSGateway();
try {
    $result = $sms->sendSMS('+33612345678', 'Bonjour depuis PHP!');
    echo 'SMS envoy√©: ' . $result['data']['id'];
} catch (Exception $e) {
    echo 'Erreur: ' . $e->getMessage();
}
?&gt;
                    </div>
                </div>

                <h3>Python</h3>
                <div class="code-container">
                    <div class="code-block">
import requests
import json

class SMSGateway:
    def __init__(self, base_url='http://168.231.85.4:3001/api'):
        self.base_url = base_url
    
    def send_sms(self, recipient, message, sim_id=None, priority='normal'):
        """Envoie un SMS via l'API Gateway"""
        data = {
            'recipient': recipient,
            'message': message,
            'priority': priority
        }
        
        if sim_id:
            data['sim_id'] = sim_id
        
        try:
            response = requests.post(
                f'{self.base_url}/messages/send',
                json=data,
                headers={'Content-Type': 'application/json'}
            )
            
            response.raise_for_status()
            return response.json()
            
        except requests.exceptions.RequestException as e:
            raise Exception(f'Erreur lors de l\'envoi: {e}')
    
    def get_history(self, page=1, limit=50, status=None):
        """R√©cup√®re l'historique des messages"""
        params = {'page': page, 'limit': limit}
        if status:
            params['status'] = status
        
        response = requests.get(
            f'{self.base_url}/messages/history',
            params=params
        )
        
        response.raise_for_status()
        return response.json()
    
    def get_sims_status(self):
        """R√©cup√®re le statut des SIMs"""
        response = requests.get(f'{self.base_url}/sims')
        response.raise_for_status()
        return response.json()

# Utilisation
if __name__ == '__main__':
    gateway = SMSGateway()
    
    try:
        # Envoyer un SMS
        result = gateway.send_sms(
            recipient='+33612345678',
            message='Bonjour depuis Python!',
            priority='high'
        )
        print(f"SMS envoy√© avec l'ID: {result['data']['id']}")
        
        # R√©cup√©rer l'historique
        history = gateway.get_history(limit=10)
        print(f"Nombre de messages: {len(history['data'])}")
        
    except Exception as e:
        print(f"Erreur: {e}")
                    </div>
                </div>

                <h3>cURL</h3>
                <div class="code-container">
                    <div class="code-block">
# Envoyer un SMS
curl -X POST "http://168.231.85.4:3001/api/messages/send" \
  -H "Content-Type: application/json" \
  -d '{
    "recipient": "+33612345678",
    "message": "Test depuis cURL",
    "priority": "normal"
  }'

# R√©cup√©rer l'historique
curl -X GET "http://168.231.85.4:3001/api/messages/history?page=1&limit=20"

# V√©rifier le statut des SIMs
curl -X GET "http://168.231.85.4:3001/api/sims"

# Configurer l'auto-switch
curl -X PUT "http://168.231.85.4:3001/api/autoswitch/config" \
  -H "Content-Type: application/json" \
  -d '{
    "auto_switch_enabled": true,
    "quota_alert_threshold": 80,
    "quota_check_frequency": 180
  }'
                    </div>
                </div>
            </div>

            <!-- SDKs -->
            <div id="sdks" class="doc-section">
                <h2><i class="fas fa-puzzle-piece"></i> SDKs et Biblioth√®ques</h2>
                
                <h3>SDK JavaScript/TypeScript</h3>
                <div class="integration-example">
                    <h4>Installation</h4>
                    <div class="code-block">
npm install sms-gateway-sdk
# ou
yarn add sms-gateway-sdk
                    </div>
                    
                    <h4>Utilisation</h4>
                    <div class="code-block">
import { SMSGateway } from 'sms-gateway-sdk';

const gateway = new SMSGateway({
  baseUrl: 'http://168.231.85.4:3001/api',
  apiKey: 'your-api-key' // optionnel
});

// Envoi simple
await gateway.sendSMS('+33612345678', 'Hello World!');

// Envoi avec options
await gateway.sendSMS('+33612345678', 'Message urgent', {
  priority: 'high',
  simId: 32
});

// √âcouter les √©v√©nements
gateway.on('message.sent', (data) => {
  console.log('Message envoy√©:', data.messageId);
});
                    </div>
                </div>

                <h3>Wrapper WordPress</h3>
                <div class="integration-example">
                    <h4>Plugin WordPress</h4>
                    <div class="code-block">
// functions.php
function send_sms_notification($phone, $message) {
    $response = wp_remote_post('http://168.231.85.4:3001/api/messages/send', [
        'headers' => ['Content-Type' => 'application/json'],
        'body' => json_encode([
            'recipient' => $phone,
            'message' => $message
        ])
    ]);
    
    if (is_wp_error($response)) {
        error_log('SMS Error: ' . $response->get_error_message());
        return false;
    }
    
    $body = json_decode(wp_remote_retrieve_body($response), true);
    return $body['success'] ?? false;
}

// Utilisation dans un hook
add_action('woocommerce_order_status_completed', function($order_id) {
    $order = wc_get_order($order_id);
    $phone = $order->get_billing_phone();
    
    send_sms_notification($phone, 
        "Votre commande #{$order_id} a √©t√© exp√©di√©e !"
    );
});
                    </div>
                </div>
            </div>

            <!-- Error Handling -->
            <div id="errors" class="doc-section">
                <h2><i class="fas fa-exclamation-triangle"></i> Gestion d'erreurs</h2>
                
                <h3>Codes de statut HTTP</h3>
                <table class="parameter-table">
                    <tr>
                        <th>Code</th>
                        <th>Signification</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><span class="status-code status-200">200</span></td>
                        <td>OK</td>
                        <td>Requ√™te r√©ussie</td>
                    </tr>
                    <tr>
                        <td><span class="status-code status-400">400</span></td>
                        <td>Bad Request</td>
                        <td>Param√®tres invalides ou manquants</td>
                    </tr>
                    <tr>
                        <td><span class="status-code status-400">404</span></td>
                        <td>Not Found</td>
                        <td>Ressource non trouv√©e</td>
                    </tr>
                    <tr>
                        <td><span class="status-code status-500">429</span></td>
                        <td>Too Many Requests</td>
                        <td>Limite de taux d√©pass√©e</td>
                    </tr>
                    <tr>
                        <td><span class="status-code status-500">500</span></td>
                        <td>Internal Server Error</td>
                        <td>Erreur interne du serveur</td>
                    </tr>
                </table>

                <h3>Format des erreurs</h3>
                <div class="response-example">
{
  "success": false,
  "message": "Num√©ro de t√©l√©phone invalide",
  "error_code": "INVALID_PHONE_NUMBER",
  "details": {
    "field": "recipient",
    "provided": "123456",
    "expected": "Format international (+33612345678)"
  }
}
                </div>

                <h3>Gestion des erreurs recommand√©e</h3>
                <div class="code-container">
                    <div class="code-block">
// JavaScript
const handleSMSError = (error) => {
  switch (error.error_code) {
    case 'INVALID_PHONE_NUMBER':
      return 'Le num√©ro de t√©l√©phone n\'est pas valide';
    case 'SIM_NOT_AVAILABLE':
      return 'Aucune SIM disponible pour l\'envoi';
    case 'QUOTA_EXCEEDED':
      return 'Quota mensuel d√©pass√©';
    case 'MESSAGE_TOO_LONG':
      return 'Le message est trop long';
    default:
      return 'Erreur inconnue lors de l\'envoi';
  }
};

try {
  await sendSMS('+33612345678', 'Test');
} catch (error) {
  const userMessage = handleSMSError(error);
  console.error(userMessage);
}
                    </div>
                </div>

                <h3>Retry et Circuit Breaker</h3>
                <div class="integration-example">
                    <h4>Strat√©gie de retry recommand√©e</h4>
                    <div class="code-block">
const sendSMSWithRetry = async (recipient, message, maxRetries = 3) => {
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      return await sendSMS(recipient, message);
    } catch (error) {
      if (attempt === maxRetries) throw error;
      
      // Backoff exponentiel
      const delay = Math.pow(2, attempt) * 1000;
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
};
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="doc-section">
                <h2><i class="fas fa-question-circle"></i> Support et Contact</h2>
                <p>Pour toute question ou probl√®me avec l'API SMS Gateway :</p>
                <ul>
                    <li>üìß Email: support@smsgateway.com</li>
                    <li>üì± T√©l√©phone: +33 1 23 45 67 89</li>
                    <li>üêõ Issues GitHub: <a href="https://github.com/votre-repo/sms-gateway/issues">github.com/votre-repo/sms-gateway</a></li>
                    <li>üìñ Documentation: <a href="https://docs.smsgateway.com">docs.smsgateway.com</a></li>
                </ul>
                
                <p><strong>Version de l'API:</strong> 1.0.0<br>
                <strong>Derni√®re mise √† jour:</strong> 26 mai 2025</p>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Smooth scrolling pour les liens d'ancrage
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                    
                    // Mettre √† jour la navigation active
                    document.querySelectorAll('.doc-sidebar .nav-link').forEach(link => {
                        link.classList.remove('active');
                    });
                    this.classList.add('active');
                }
            });
        });

        // Copier le code dans le presse-papiers
        document.querySelectorAll('.code-block').forEach(block => {
            const button = document.createElement('button');
            button.className = 'copy-button';
            button.innerHTML = '<i class="fas fa-copy"></i> Copier';
            button.onclick = () => {
                navigator.clipboard.writeText(block.textContent).then(() => {
                    button.innerHTML = '<i class="fas fa-check"></i> Copi√©!';
                    setTimeout(() => {
                        button.innerHTML = '<i class="fas fa-copy"></i> Copier';
                    }, 2000);
                });
            };
            
            const container = document.createElement('div');
            container.className = 'code-container';
            block.parentNode.insertBefore(container, block);
            container.appendChild(block);
            container.appendChild(button);
        });

        // Mise √† jour de la navigation active au scroll
        const observerOptions = {
            rootMargin: '-20% 0px -80% 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.id;
                    document.querySelectorAll('.doc-sidebar .nav-link').forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === `#${id}`) {
                            link.classList.add('active');
                        }
                    });
                }
            });
        }, observerOptions);

        document.querySelectorAll('.doc-section[id]').forEach(section => {
            observer.observe(section);
        });
    </script>
</body>
</html> 