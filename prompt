# üöÄ PROMPT COMPLET - CR√âATION APPLICATION SMS GATEWAY

Cr√©ez une application SMS Gateway compl√®te permettant d'envoyer des SMS via des t√©l√©phones Android connect√©s. L'application doit comprendre 3 composants principaux : Backend API, Frontend Web, et Application Android.

## üéØ ARCHITECTURE G√âN√âRALE

### Technologies Backend :
- Node.js avec Express.js
- MySQL pour la base de donn√©es
- Cors, mysql2, bcrypt, PM2
- Port par d√©faut : 3001

### Technologies Frontend :
- HTML5, CSS3, JavaScript vanilla ou React
- Bootstrap 5 ou Tailwind CSS
- Design cyberpunk/futuriste avec palette sombre
- Couleurs : Fond #0F0F23, cartes #1A1A2E, accents n√©on #00D4FF, #9D00FF, #00FF88
- Effets lumineux, animations, typographie 'Orbitron'

### Technologies Android :
- Android Studio avec Kotlin
- Minimum SDK : Android 6.0 (API 23)
- Permissions : SMS, PHONE, INTERNET, WAKE_LOCK
- Service d'arri√®re-plan persistant

## üìä STRUCTURE BASE DE DONN√âES

```sql
-- Base de donn√©es : sms_gateway
CREATE DATABASE IF NOT EXISTS sms_gateway;

-- Table des t√©l√©phones Android
CREATE TABLE phones (
    id INT AUTO_INCREMENT PRIMARY KEY,
    tel_id VARCHAR(100) NOT NULL UNIQUE,
    model VARCHAR(100) NOT NULL,
    status ENUM('online', 'offline') DEFAULT 'offline',
    last_seen TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    service_status VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Table des cartes SIM
CREATE TABLE sims (
    sim_id INT AUTO_INCREMENT PRIMARY KEY,
    device_id VARCHAR(100) NOT NULL,
    slot_index INT NOT NULL,
    phone_number VARCHAR(20) NOT NULL,
    operator VARCHAR(50),
    status ENUM('active', 'inactive') DEFAULT 'active',
    messages_sent INT DEFAULT 0,
    daily_limit INT DEFAULT 100,
    recipient_limit INT DEFAULT 50,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (device_id) REFERENCES phones(tel_id) ON DELETE CASCADE
);

-- Table historique SMS
CREATE TABLE sms_history (
    id INT AUTO_INCREMENT PRIMARY KEY,
    recipient VARCHAR(20) NOT NULL,
    message TEXT NOT NULL,
    sim_id INT,
    sent_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    status ENUM('sent', 'failed', 'pending') DEFAULT 'pending',
    failure_reason TEXT,
    FOREIGN KEY (sim_id) REFERENCES sims(sim_id) ON DELETE SET NULL
);

-- Table configuration syst√®me
CREATE TABLE system_config (
    id INT AUTO_INCREMENT PRIMARY KEY,
    config_key VARCHAR(50) NOT NULL UNIQUE,
    config_value TEXT,
    description TEXT,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Configuration par d√©faut
INSERT INTO system_config (config_key, config_value, description) VALUES
('default_sim_id', NULL, 'ID de la SIM par d√©faut pour envoi'),
('auto_switch_enabled', 'true', 'Basculement automatique entre SIMs'),
('api_rate_limit', '100', 'Limite requ√™tes API par minute'),
('notifications_enabled', 'true', 'Notifications syst√®me activ√©es');

-- Table utilisateurs
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(100) UNIQUE,
    api_key VARCHAR(100) UNIQUE,
    role ENUM('admin', 'user') DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Utilisateur admin par d√©faut (mot de passe: admin123)
INSERT INTO users (username, password, email, api_key, role) VALUES
('admin', '$2b$10$GQT0onaZqx5W7gVaDLCkbe2EP/yGHUUDmUSlDkO2kf3/QZ/KLKCFi', 'admin@smsgateway.com', 'SG_API_9f8d2c1b3a4e5f6d7c8b9a1c2d3e4f5g6h7i8j9k0l', 'admin');
```

## üîß BACKEND API - ROUTES ESSENTIELLES

### Routes de base :
- `GET /api/health` - V√©rification √©tat API + connexion BDD
- `GET /api/system/config` - Configuration syst√®me compl√®te
- `PUT /api/system/config` - Mise √† jour configuration
- `GET /api/system/failover/status` - Statut basculement automatique

### Routes t√©l√©phones :
- `GET /api/phones` - Liste t√©l√©phones avec SIMs associ√©es
- `GET /api/phones/:id` - D√©tails t√©l√©phone sp√©cifique
- `POST /api/phones/register` - Enregistrement nouveau t√©l√©phone
- `PUT /api/phones/:id/heartbeat` - Mise √† jour statut (heartbeat)
- `DELETE /api/phones/:id` - Suppression t√©l√©phone

### Routes SIMs :
- `GET /api/sims` - Liste toutes SIMs disponibles
- `GET /api/sims/:id` - D√©tails SIM sp√©cifique
- `PUT /api/sims/:id/config` - Configuration SIM (limites, statut)
- `GET /api/sims/stats` - Statistiques utilisation SIMs

### Routes messagerie :
- `POST /api/messages/send` - Envoi SMS simple
- `POST /api/messages/send-bulk` - Envoi en masse (CSV/JSON)
- `GET /api/messages/history` - Historique complet avec filtres
- `GET /api/messages/stats` - Statistiques envois (quotidien/mensuel)
- `GET /api/messages/pending` - Messages en attente (pour app Android)
- `PUT /api/messages/:id/status` - Mise √† jour statut message
- `DELETE /api/messages/:id` - Suppression message

### Fonctionnalit√©s backend obligatoires :
1. **Gestion multi-SIM** : Support plusieurs cartes par t√©l√©phone
2. **Basculement automatique** : Changement SIM si probl√®me/quota atteint/hors ligne
3. **Syst√®me heartbeat** : Surveillance √©tat t√©l√©phones (toutes les 30s)
4. **Gestion quotas** : Limites quotidiennes par SIM + destinataires uniques
5. **Authentification** : JWT tokens + API keys
6. **Rate limiting** : Protection contre spam
7. **Logging complet** : Tous √©v√©nements en base
8. **Validation** : Sanitisation entr√©es + formats num√©ros
9. **CORS** : Support requ√™tes cross-origin
10. **Error handling** : Gestion erreurs robuste

## üé® FRONTEND WEB - INTERFACE ADMINISTRATION

### Design cyberpunk obligatoire :
- **Palette sombre** : #0F0F23 (fond), #1A1A2E (cartes), #16213E (√©l√©ments)
- **Accents n√©on** : #00D4FF (bleu), #9D00FF (violet), #00FF88 (vert), #FF6600 (orange)
- **Effets lumineux** : box-shadow et text-shadow n√©on sur √©l√©ments interactifs
- **Typographie** : 'Orbitron' (titres), 'Space Mono' (texte), espacement large
- **Animations** : Pulsations n√©on, hover effects, transitions 300ms
- **Bordures** : Fines avec transparence 30-60%, intensification au hover

### Pages obligatoires :

#### 1. Dashboard principal :
- **M√©triques temps r√©el** : SMS envoy√©s aujourd'hui, t√©l√©phones en ligne, SIMs actives, messages en attente
- **Graphiques** : √âvolution envois (7 derniers jours), r√©partition par SIM, taux succ√®s
- **Cartes statut** : Chaque t√©l√©phone avec indicateur online/offline pulsant
- **Alertes** : Notifications quotas atteints, t√©l√©phones d√©connect√©s, erreurs syst√®me
- **Activit√© r√©cente** : Derniers SMS envoy√©s avec statuts

#### 2. Gestion t√©l√©phones :
- **Tableau responsive** : ID, mod√®le, statut, derni√®re connexion, SIMs, actions
- **Filtres** : Par statut, mod√®le, derni√®re activit√©
- **Actions** : Voir d√©tails, red√©marrer service, configurer, supprimer
- **Modal d√©tails** : Informations compl√®tes + historique connexions
- **Indicateurs visuels** : Points color√©s pour statuts, badges pour nombre SIMs

#### 3. Gestion SIMs :
- **Vue grille/tableau** : Num√©ro, op√©rateur, t√©l√©phone, quotas, messages envoy√©s
- **Configuration** : Modal pour limites quotidiennes, statut actif/inactif
- **Statistiques** : Graphiques utilisation, destinataires uniques
- **Basculement** : Interface pour d√©finir SIM par d√©faut + ordre priorit√©
- **Monitoring** : Alertes visuelles si quotas proches

#### 4. Envoi SMS :
- **Formulaire simple** : Destinataire, message, choix SIM (optionnel)
- **Envoi masse** : Upload CSV, zone texte multi-lignes, s√©lection SIM
- **Pr√©visualisation** : Aper√ßu message + estimation co√ªt
- **Validation temps r√©el** : Format num√©ros, longueur message
- **Historique rapide** : Derniers destinataires pour re-envoi facile
- **Templates** : Messages pr√©d√©finis sauvegardables

#### 5. Historique & Analytics :
- **Tableau pagin√©** : Tous SMS avec filtres avanc√©s (date, num√©ro, SIM, statut)
- **Recherche** : Recherche textuelle dans messages + num√©ros
- **Export** : CSV, PDF avec filtres appliqu√©s
- **Graphiques** : √âvolution temporelle, r√©partition par statut/SIM
- **Statistiques** : Taux succ√®s, temps moyen envoi, pics d'activit√©

#### 6. Configuration syst√®me :
- **Param√®tres g√©n√©raux** : SIM par d√©faut, basculement auto, limites globales
- **Notifications** : Email alerts, webhooks, seuils d'alerte
- **S√©curit√©** : Gestion utilisateurs, changement mots de passe, API keys
- **Maintenance** : Nettoyage logs, sauvegarde BDD, red√©marrage services
- **Monitoring** : √âtat services, utilisation ressources, logs syst√®me

### Interface responsive obligatoire :
- **Mobile-first** : Navigation burger, cartes empil√©es, tableaux scrollables
- **Breakpoints** : 768px (tablet), 1024px (desktop), 1440px (large)
- **Touch-friendly** : Boutons 44px minimum, espacement g√©n√©reux
- **Performance** : Lazy loading, pagination, optimisation images

## üì± APPLICATION ANDROID

### Fonctionnalit√©s obligatoires :

#### 1. Configuration initiale :
- **Assistant setup** : 4 √©tapes (serveur, permissions, SIMs, test)
- **Connexion serveur** : URL API + cl√© authentification avec test connexion
- **Permissions** : Demande SMS, PHONE, INTERNET + v√©rification continue
- **Auto-enregistrement** : Envoi infos t√©l√©phone au serveur (mod√®le, SIMs d√©tect√©es)
- **Validation** : Test envoi SMS + heartbeat avant finalisation

#### 2. Service arri√®re-plan :
- **Service persistant** : Foreground service avec notification permanente
- **Polling intelligent** : V√©rification messages toutes les 10-30s (adaptatif)
- **Envoi SMS** : Traitement queue avec retry automatique (3 tentatives)
- **Heartbeat** : Signal vie au serveur toutes les 30s avec √©tat SIMs
- **Gestion r√©seau** : Reconnexion auto, cache local si offline

#### 3. Gestion multi-SIM :
- **D√©tection auto** : Scan SIMs disponibles au d√©marrage + changements
- **S√©lection intelligente** : Choix SIM selon configuration serveur
- **Basculement** : Switch automatique si SIM principale indisponible
- **Monitoring** : Surveillance √©tat SIMs + rapport anomalies

#### 4. Interface utilisateur :
- **Dashboard** : Statut connexion, messages envoy√©s/jour, SIMs actives
- **Configuration** : URL serveur, intervalle polling, notifications
- **Logs locaux** : Historique actions avec niveaux (info/warning/error)
- **Diagnostics** : Tests connexion, permissions, √©tat SIMs, envoi test
- **Statistiques** : Graphiques envois, r√©partition SIMs, taux succ√®s

#### 5. Optimisations :
- **Batterie** : Doze mode compatibility, optimisations √©nerg√©tiques
- **R√©seau** : Compression donn√©es, cache intelligent, retry exponential
- **Notifications** : Alertes erreurs critiques, r√©sum√©s quotidiens
- **S√©curit√©** : Chiffrement communications, validation certificats serveur
- **Performance** : Threading optimal, gestion m√©moire, cleanup automatique

### Architecture Android :
```kotlin
// Composants principaux
MainActivity : Interface principale + configuration
SmsService : Service arri√®re-plan pour envoi
ApiClient : Communication serveur (Retrofit/OkHttp)
SmsManager : Gestion envoi multi-SIM
DatabaseHelper : Cache local SQLite
NotificationManager : Notifications syst√®me
ConfigManager : Gestion configuration locale
```

## üöÄ FONCTIONNALIT√âS AVANC√âES

### Backend avanc√© :
1. **Templates SMS** : Messages pr√©d√©finis avec variables
2. **Planification** : Envois programm√©s (date/heure)
3. **Webhooks** : Notifications externes (succ√®s/√©chec)
4. **API externe** : Endpoints pour int√©gration tiers
5. **Analytics** : Rapports d√©taill√©s, m√©triques performance
6. **Backup auto** : Sauvegarde quotidienne BDD
7. **Load balancing** : R√©partition charge multi-serveurs
8. **Monitoring** : Surveillance proactive avec alertes

### Frontend avanc√© :
1. **Th√®mes** : Mode sombre/clair + personnalisation couleurs
2. **Widgets** : Composants r√©utilisables (graphiques, cartes)
3. **PWA** : Application web progressive avec offline
4. **Temps r√©el** : WebSockets pour mises √† jour live
5. **Internationalisation** : Support multi-langues
6. **Accessibilit√©** : WCAG compliance, navigation clavier
7. **Performance** : Code splitting, lazy loading, caching
8. **Tests** : Unit tests + E2E avec Cypress/Playwright

### Android avanc√© :
1. **G√©olocalisation** : Tracking position pour analytics
2. **Chiffrement** : Messages chiffr√©s bout-en-bout
3. **Backup cloud** : Synchronisation configuration
4. **Widget home** : Widget √©cran accueil avec stats
5. **Intents** : Int√©gration autres apps (partage)
6. **Wear OS** : Support montres connect√©es
7. **Auto-update** : Mise √† jour automatique APK
8. **Crash reporting** : Rapports erreurs automatiques

## üîí S√âCURIT√â OBLIGATOIRE

### Backend :
- **Authentification JWT** : Tokens avec expiration
- **Rate limiting** : 100 req/min par IP
- **Validation stricte** : Sanitisation toutes entr√©es
- **HTTPS obligatoire** : Certificats SSL/TLS
- **Audit logs** : Tra√ßabilit√© compl√®te actions
- **Chiffrement BDD** : Donn√©es sensibles chiffr√©es
- **Firewall** : Restriction acc√®s ports
- **Backup s√©curis√©** : Chiffrement sauvegardes

### Frontend :
- **CSP headers** : Content Security Policy
- **XSS protection** : Sanitisation affichage
- **CSRF tokens** : Protection requ√™tes
- **Session management** : Timeout automatique
- **Input validation** : Validation c√¥t√© client + serveur
- **Secure cookies** : HttpOnly, Secure flags
- **Error handling** : Pas d'exposition infos sensibles

### Android :
- **Certificat pinning** : Validation serveur
- **Obfuscation** : Code obfusqu√© (ProGuard)
- **Root detection** : Blocage appareils root√©s
- **Keystore** : Stockage s√©curis√© cl√©s
- **Network security** : Config r√©seau s√©curis√©e
- **App signing** : Signature APK obligatoire
- **Permissions minimales** : Principe moindre privil√®ge

## üì¶ D√âPLOIEMENT

### Serveur production :
- **OS** : Ubuntu 20.04+ LTS
- **Reverse proxy** : Nginx avec SSL
- **Process manager** : PM2 avec cluster mode
- **Base donn√©es** : MySQL 8.0+ avec r√©plication
- **Monitoring** : Prometheus + Grafana
- **Logs** : ELK Stack (Elasticsearch, Logstash, Kibana)
- **Backup** : Scripts automatis√©s quotidiens
- **CDN** : CloudFlare pour assets statiques

### Configuration Nginx :
```nginx
server {
    listen 443 ssl http2;
    server_name sms-gateway.com;
    
    ssl_certificate /etc/letsencrypt/live/sms-gateway.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/sms-gateway.com/privkey.pem;
    
    # Frontend
    location / {
        root /var/www/sms-gateway/frontend;
        try_files $uri $uri/ /index.html;
        gzip on;
        expires 1y;
    }
    
    # API Backend
    location /api/ {
        proxy_pass http://localhost:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### Scripts d√©ploiement :
1. **deploy.sh** : D√©ploiement automatis√© complet
2. **backup.sh** : Sauvegarde BDD + fichiers
3. **update.sh** : Mise √† jour application
4. **monitor.sh** : Surveillance syst√®me
5. **restore.sh** : Restauration depuis backup

## ‚úÖ CHECKLIST VALIDATION

### Backend :
- [ ] Toutes routes API fonctionnelles
- [ ] Gestion erreurs robuste
- [ ] Authentification s√©curis√©e
- [ ] Base donn√©es optimis√©e
- [ ] Logging complet
- [ ] Tests unitaires
- [ ] Documentation API
- [ ] Performance optimis√©e

### Frontend :
- [ ] Design cyberpunk complet
- [ ] Toutes pages fonctionnelles
- [ ] Responsive parfait
- [ ] Animations fluides
- [ ] Gestion erreurs
- [ ] Tests E2E
- [ ] Accessibilit√©
- [ ] Performance optimis√©e

### Android :
- [ ] Service arri√®re-plan stable
- [ ] Gestion multi-SIM
- [ ] Interface intuitive
- [ ] Optimisations batterie
- [ ] Gestion erreurs
- [ ] Tests sur appareils
- [ ] S√©curit√© renforc√©e
- [ ] Documentation utilisateur

### D√©ploiement :
- [ ] Serveur configur√©
- [ ] SSL activ√©
- [ ] Monitoring en place
- [ ] Backups automatiques
- [ ] Scripts d√©ploiement
- [ ] Documentation admin
- [ ] Tests production
- [ ] Plan maintenance

## üéØ LIVRABLES ATTENDUS

1. **Code source complet** : Backend + Frontend + Android
2. **Base donn√©es** : Scripts cr√©ation + donn√©es test
3. **Documentation** : Installation, configuration, utilisation
4. **Scripts d√©ploiement** : Automatisation compl√®te
5. **Tests** : Suites tests automatis√©s
6. **Configuration** : Fichiers environnement
7. **Monitoring** : Dashboards + alertes
8. **Manuel utilisateur** : Guide complet

Cette sp√©cification compl√®te permet de recr√©er votre application SMS Gateway avec toutes ses fonctionnalit√©s. Chaque composant est d√©taill√© avec les technologies, fonctionnalit√©s et exigences pr√©cises.